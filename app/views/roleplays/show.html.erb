<h1 id="roleplay_title"><%= @roleplay.name %></h1>

<div class="row">

  <!-- column for actual chatting-->
  <div class="col-8 mx-5">
    <div class="rounded" id="messages" data-roleplay-id="<%= @roleplay.id %>">
      <% @messages = @roleplay.messages %>
      <% for @message in @messages do %>
        <%= image_tag(@message.character.image(:thumb),  :class => 'card-img-left') %>
	&nbsp;<%= @message.character.name%> said:</br>
        &nbsp;<%= @message.body %>
        <div class="clear"></div>
        </br>
      <% end %>
      <!--<%= render @roleplay.messages %>-->
    </div>
        <div class="form-group">
          Body:</br>
          <textarea id="message_body" class="form-control"></textarea>
          <small class="text-muted">From 2 to 1000 characters</small>
        </div>
        <div id="submit_field" class="btn btn-primary btn-lg">Submit message</div>


  </div>
</br>
  <!-- column for character selection-->
  <div class="col-3">
      <% @my_characters.each do |character| %>
      <div class="card bg-light border-dark character-card" id="card_for_<%=character.id%>"%>
          <div>
              <img src="<%=character.image(:thumb)%>" id="character-image-<%=character.id%>" class="card-img-left" />
              <div id="character-id-<%=character.id%>" class="center-in-me-please character-name-box">
                <h5 id="character-name-<%=character.name%>" class="character_name">&nbsp;<%= character.name %></h5>
              </div>
          </div>
      </div>

     <%end%>
  </div>
</div>
<script>
  $("#message_body").val("");
 $("#messages").scrollTop($("#messages")[0].scrollHeight);  //goes at the bottom of the scroll of messages so you don't have to scroll
  //select by default the first character in the list
  $(".character-card").first().removeClass('bg-light');
  $(".character-card").first().addClass('bg-dark');
  $(".character-card").click(function(){
    $(".character-card").removeClass('bg-dark');
    $(".character-card").addClass('bg-light');
    $(this).addClass('bg-dark');
    $("#message_body").val("");//empty the submit message so the new character can write its thoughts
  });
  $("#submit_field").click(function(){
    var message_body = $("#message_body").val();
    var id = $('.bg-dark.character-card').attr('id').substring(9);//.children().second().attr('id');
    var name = $("#character-id-" + id).children().first().text();
    $.get('/roleplays/message_to_append/' + String(id), function(data1){
       
       $.post("/messages/save_message", {character_id: String(id), body: String(message_body), roleplay_id: "<%=@roleplay.id%>"}, function(data, status){
        $("#messages").append(data1 + "&nbsp;" + message_body + "</br><div class='clear'></div>"); 
        $("#message_body").val("");  
        $("#messages").scrollTop($("#messages")[0].scrollHeight);  
       });      
    });
  });
</script>
